<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nevent SDK - Test with Mock API</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 40px 20px;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
      }

      .header {
        text-align: center;
        color: white;
        margin-bottom: 60px;
      }

      .header h1 {
        font-size: 3rem;
        font-weight: 700;
        margin-bottom: 10px;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      }

      .header p {
        font-size: 1.2rem;
        opacity: 0.9;
      }

      .badge {
        display: inline-block;
        background: rgba(255, 255, 255, 0.2);
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 0.9rem;
        margin: 10px 5px 0;
        backdrop-filter: blur(10px);
      }

      .badge.success {
        background: rgba(16, 185, 129, 0.3);
      }

      .badge.warning {
        background: rgba(245, 158, 11, 0.3);
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 30px;
        margin-bottom: 40px;
      }

      .card {
        background: white;
        border-radius: 16px;
        padding: 0;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        overflow: hidden;
      }

      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
      }

      .card-header {
        padding: 24px 30px;
        border-bottom: 1px solid #e5e7eb;
        background: linear-gradient(135deg, #f9fafb 0%, #ffffff 100%);
      }

      .card-header h2 {
        font-size: 1.5rem;
        margin-bottom: 8px;
        color: #111827;
      }

      .card-header p {
        color: #6b7280;
        font-size: 0.9rem;
        line-height: 1.5;
      }

      .card-meta {
        display: flex;
        gap: 12px;
        margin-top: 12px;
        flex-wrap: wrap;
      }

      .meta-tag {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 500;
        background: #f3f4f6;
        color: #374151;
      }

      .meta-tag.success {
        background: #d1fae5;
        color: #065f46;
      }

      .card-body {
        padding: 30px;
        min-height: 500px;
      }

      .widget-container {
        min-height: 450px;
      }

      .info-section {
        background: white;
        border-radius: 16px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }

      .info-section h2 {
        color: #667eea;
        margin-bottom: 20px;
        font-size: 1.75rem;
      }

      .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
      }

      .info-item {
        padding: 20px;
        background: linear-gradient(135deg, #f9fafb 0%, #ffffff 100%);
        border-radius: 12px;
        border-left: 4px solid #667eea;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      }

      .info-item strong {
        display: block;
        color: #111827;
        margin-bottom: 8px;
        font-size: 0.875rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .info-item code {
        background: #f3f4f6;
        padding: 4px 8px;
        border-radius: 6px;
        font-size: 0.875rem;
        color: #374151;
        display: block;
        word-break: break-all;
      }

      .console {
        background: #1e1e1e;
        color: #d4d4d4;
        padding: 20px;
        border-radius: 12px;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 0.85rem;
        max-height: 400px;
        overflow-y: auto;
        margin-top: 20px;
        box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.3);
      }

      .console-line {
        padding: 6px 0;
        border-bottom: 1px solid #2d2d2d;
        line-height: 1.5;
      }

      .console-line:last-child {
        border-bottom: none;
      }

      .console-line.success {
        color: #4ec9b0;
      }

      .console-line.error {
        color: #f48771;
      }

      .console-line.info {
        color: #569cd6;
      }

      .console-line.warn {
        color: #dcdcaa;
      }

      .test-buttons {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        margin-top: 20px;
      }

      .test-btn {
        background: #667eea;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.9rem;
        font-weight: 500;
        transition: all 0.2s ease;
        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
      }

      .test-btn:hover {
        background: #5a67d8;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
      }

      .test-btn:active {
        transform: translateY(0);
      }

      .test-btn.secondary {
        background: #6b7280;
        box-shadow: 0 2px 8px rgba(107, 114, 128, 0.3);
      }

      .test-btn.secondary:hover {
        background: #4b5563;
        box-shadow: 0 4px 12px rgba(107, 114, 128, 0.4);
      }

      @media (max-width: 768px) {
        .header h1 {
          font-size: 2rem;
        }

        .grid {
          grid-template-columns: 1fr;
        }

        .info-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <div class="header">
        <h1>üöÄ Nevent SDK Test</h1>
        <p>Testing CDN deployment with mocked API responses</p>
        <div class="badge success">
          ‚úÖ Loaded from: dev.neventapps.com/subs/latest/
        </div>
        <div class="badge warning">
          üîß API: Mocked (simulating DB configs)
        </div>
      </div>

      <!-- Info Section -->
      <div class="info-section">
        <h2>üìä SDK Information</h2>
        <div class="info-grid">
          <div class="info-item">
            <strong>CDN URL</strong>
            <code id="cdn-url">https://dev.neventapps.com/subs/latest/</code>
          </div>
          <div class="info-item">
            <strong>SDK Version</strong>
            <code id="sdk-version">v2.0.0</code>
          </div>
          <div class="info-item">
            <strong>Bundle Size</strong>
            <code id="bundle-size">Loading...</code>
          </div>
          <div class="info-item">
            <strong>Load Time</strong>
            <code id="load-time">Loading...</code>
          </div>
          <div class="info-item">
            <strong>API Mode</strong>
            <code>MOCK (intercepted fetch)</code>
          </div>
          <div class="info-item">
            <strong>Config Source</strong>
            <code>Simulated MongoDB responses</code>
          </div>
        </div>
      </div>

      <!-- Widget Examples -->
      <div class="grid">
        <!-- Newsletter 1: Minimalista -->
        <div class="card">
          <div class="card-header">
            <h2>üìß Minimalista</h2>
            <p>Widget con configuraci√≥n m√≠nima. Solo email requerido.</p>
            <div class="card-meta">
              <span class="meta-tag success">‚úÖ Mock API</span>
              <span class="meta-tag">Font: Inter</span>
              <span class="meta-tag">Theme: Light Blue</span>
            </div>
          </div>
          <div class="card-body">
            <div id="widget-1" class="widget-container"></div>
          </div>
        </div>

        <!-- Newsletter 2: Moderna Vibrante -->
        <div class="card">
          <div class="card-header">
            <h2>üé® Moderna Vibrante</h2>
            <p>Colores vibrantes amarillos con todos los campos.</p>
            <div class="card-meta">
              <span class="meta-tag success">‚úÖ Mock API</span>
              <span class="meta-tag">Font: Poppins</span>
              <span class="meta-tag">Theme: Yellow/Amber</span>
            </div>
          </div>
          <div class="card-body">
            <div id="widget-2" class="widget-container"></div>
          </div>
        </div>

        <!-- Newsletter 3: Elegante Oscura -->
        <div class="card">
          <div class="card-header">
            <h2>‚ö° Elegante Oscura</h2>
            <p>Tema oscuro elegante con tipograf√≠a serif.</p>
            <div class="card-meta">
              <span class="meta-tag success">‚úÖ Mock API</span>
              <span class="meta-tag">Font: Playfair Display</span>
              <span class="meta-tag">Theme: Dark</span>
            </div>
          </div>
          <div class="card-body">
            <div id="widget-3" class="widget-container"></div>
          </div>
        </div>
      </div>

      <!-- Test Console -->
      <div class="info-section">
        <h2>üîç Test Console</h2>
        <div class="test-buttons">
          <button class="test-btn" onclick="testSDKLoaded()">
            ‚úÖ Check SDK
          </button>
          <button class="test-btn secondary" onclick="clearConsole()">
            üóëÔ∏è Clear Console
          </button>
        </div>
        <div id="console" class="console">
          <div class="console-line info">
            [INFO] Console ready. Intercepting API calls...
          </div>
        </div>
      </div>
    </div>

    <!-- Mock API configurations -->
    <script>
      const MOCK_CONFIGS = {
        '697f9be729f8891a5cd890bb': {
          name: 'SDK Test - Minimalista',
          fields: {
            email: { enabled: true, required: true, placeholder: 'Tu email' },
            firstName: { enabled: false },
            lastName: { enabled: false },
          },
          messages: {
            submit: 'Suscribirse',
            success: '¬°Gracias por suscribirte!',
            error: 'Error al suscribirse. Intenta de nuevo.',
          },
          styles: {
            global: {
              font: {
                type: 'GOOGLE_FONT',
                family: 'Inter',
                subsets: ['latin'],
                variants: ['regular', '600'],
              },
              backgroundColor: '#ffffff',
              innerPadding: '32px',
              direction: 'column',
              spacingBetweenElements: '20px',
            },
            title: {
              hidden: false,
              fontSize: '28px',
              fontWeight: '600',
              color: '#1a1a1a',
            },
            subtitle: {
              hidden: false,
              fontSize: '16px',
              fontWeight: '400',
              color: '#6b7280',
            },
            input: {
              borderWidth: '1px',
              borderRadius: '8px',
              backgroundColor: '#ffffff',
              borderColor: '#e5e7eb',
              textColor: '#1a1a1a',
              height: '48px',
            },
            button: {
              borderWidth: '0px',
              borderRadius: '8px',
              backgroundColor: '#3b82f6',
              borderColor: '#3b82f6',
              textColor: '#ffffff',
              height: '48px',
            },
          },
          title: 'Newsletter Minimalista',
          subtitle: 'Suscr√≠bete para recibir actualizaciones',
        },
        '697f9be729f8891a5cd890bc': {
          name: 'SDK Test - Moderna Vibrante',
          fields: {
            email: { enabled: true, required: true, placeholder: 'Email' },
            firstName: {
              enabled: true,
              required: true,
              placeholder: 'Nombre',
            },
            lastName: {
              enabled: true,
              required: true,
              placeholder: 'Apellidos',
            },
            postalCode: {
              enabled: true,
              required: false,
              placeholder: 'C√≥digo Postal',
            },
          },
          messages: {
            submit: '¬°√önete ahora!',
            success: '¬°Bienvenido a nuestra comunidad!',
            error: 'Ups, algo sali√≥ mal.',
          },
          styles: {
            global: {
              font: {
                type: 'GOOGLE_FONT',
                family: 'Poppins',
                subsets: ['latin'],
                variants: ['regular', '600', '700'],
              },
              backgroundColor: '#fef3c7',
              innerPadding: '40px',
              direction: 'column',
              spacingBetweenElements: '24px',
            },
            title: {
              hidden: false,
              fontSize: '32px',
              fontWeight: '700',
              color: '#7c2d12',
            },
            subtitle: {
              hidden: false,
              fontSize: '18px',
              fontWeight: '400',
              color: '#92400e',
            },
            input: {
              borderWidth: '2px',
              borderRadius: '12px',
              backgroundColor: '#ffffff',
              borderColor: '#fbbf24',
              textColor: '#1a1a1a',
              height: '52px',
            },
            button: {
              borderWidth: '0px',
              borderRadius: '12px',
              backgroundColor: '#f59e0b',
              borderColor: '#f59e0b',
              textColor: '#ffffff',
              height: '52px',
            },
          },
          title: '¬°√önete a la Comunidad!',
          subtitle: 'Recibe contenido exclusivo cada semana',
        },
        '697f9be729f8891a5cd890bd': {
          name: 'SDK Test - Elegante Oscura',
          fields: {
            email: { enabled: true, required: true, placeholder: 'Email' },
            firstName: {
              enabled: true,
              required: true,
              placeholder: 'Nombre',
            },
            lastName: {
              enabled: true,
              required: false,
              placeholder: 'Apellidos',
            },
            birthDate: {
              enabled: true,
              required: false,
              placeholder: 'Fecha de Nacimiento',
            },
          },
          messages: {
            submit: 'Subscribe',
            success: 'Welcome aboard!',
            error: 'Something went wrong.',
          },
          styles: {
            global: {
              font: {
                type: 'GOOGLE_FONT',
                family: 'Playfair Display',
                subsets: ['latin'],
                variants: ['regular', '700'],
              },
              backgroundColor: '#1f2937',
              innerPadding: '48px',
              direction: 'column',
              spacingBetweenElements: '20px',
            },
            title: {
              hidden: false,
              fontSize: '36px',
              fontWeight: '700',
              color: '#f9fafb',
            },
            subtitle: {
              hidden: false,
              fontSize: '16px',
              fontWeight: '400',
              color: '#d1d5db',
            },
            input: {
              borderWidth: '1px',
              borderRadius: '6px',
              backgroundColor: '#374151',
              borderColor: '#4b5563',
              textColor: '#f9fafb',
              height: '50px',
            },
            button: {
              borderWidth: '2px',
              borderRadius: '6px',
              backgroundColor: '#10b981',
              borderColor: '#10b981',
              textColor: '#ffffff',
              height: '50px',
            },
          },
          title: 'Elegant Newsletter',
          subtitle: 'Curated content delivered to your inbox',
        },
      };

      // Intercept fetch calls to mock API responses
      const originalFetch = window.fetch;
      window.fetch = function (...args) {
        const url = args[0];
        if (
          typeof url === 'string' &&
          url.includes('/public/widget/') &&
          url.includes('/config')
        ) {
          const newsletterIdMatch = url.match(
            /\/public\/widget\/([^\/]+)\/config/
          );
          if (newsletterIdMatch) {
            const newsletterId = newsletterIdMatch[1];
            const config = MOCK_CONFIGS[newsletterId];

            if (config) {
              log(
                `üîß Mocking API response for newsletter: ${newsletterId}`,
                'warn'
              );
              return Promise.resolve({
                ok: true,
                status: 200,
                json: () => Promise.resolve(config),
              });
            }
          }
        }
        return originalFetch.apply(this, args);
      };
    </script>

    <!-- Load SDK from CDN -->
    <script src="https://dev.neventapps.com/subs/latest/nevent-subscriptions.umd.cjs"></script>

    <script>
      // Newsletter configuration
      const NEWSLETTERS = [
        {
          id: '697f9be729f8891a5cd890bb',
          name: 'Minimalista',
          containerId: 'widget-1',
        },
        {
          id: '697f9be729f8891a5cd890bc',
          name: 'Moderna Vibrante',
          containerId: 'widget-2',
        },
        {
          id: '697f9be729f8891a5cd890bd',
          name: 'Elegante Oscura',
          containerId: 'widget-3',
        },
      ];

      const TENANT_ID = 'test-tenant-sdk';
      const API_URL = 'https://api.nevent.es';

      // Console logging
      const consoleEl = document.getElementById('console');
      const startTime = performance.now();

      function log(message, type = 'info') {
        const line = document.createElement('div');
        line.className = `console-line ${type}`;
        const timestamp = new Date().toLocaleTimeString('es-ES', {
          hour: '2-digit',
          minute: '2-digit',
          second: '2-digit',
          fractionalSecondDigits: 3,
        });
        line.textContent = `[${timestamp}] [${type.toUpperCase()}] ${message}`;
        consoleEl.appendChild(line);
        consoleEl.scrollTop = consoleEl.scrollHeight;
      }

      function clearConsole() {
        consoleEl.innerHTML =
          '<div class="console-line info">[INFO] Console cleared.</div>';
      }

      function testSDKLoaded() {
        if (typeof NeventSubscriptions !== 'undefined') {
          log('‚úÖ SDK loaded successfully!', 'success');
          log(
            `   Exports: ${Object.keys(NeventSubscriptions).join(', ')}`,
            'info'
          );
        } else {
          log('‚ùå SDK not loaded!', 'error');
        }
      }

      // Initialize
      window.addEventListener('load', async function () {
        const loadTime = (performance.now() - startTime).toFixed(2);
        document.getElementById('load-time').textContent = `${loadTime}ms`;

        // Get bundle size
        fetch(
          'https://dev.neventapps.com/subs/latest/nevent-subscriptions.umd.cjs'
        )
          .then((r) => r.blob())
          .then((blob) => {
            const sizeKB = (blob.size / 1024).toFixed(2);
            document.getElementById('bundle-size').textContent = `${sizeKB} KB`;
            log(`üì¶ Bundle size: ${sizeKB} KB`, 'info');
          });

        log(`‚úÖ Page loaded (${loadTime}ms)`, 'success');

        if (typeof NeventSubscriptions === 'undefined') {
          log('‚ùå SDK not available!', 'error');
          return;
        }

        log('‚úÖ SDK loaded from CDN', 'success');
        log('üîß API calls will be mocked', 'warn');

        // Initialize widgets
        for (const newsletter of NEWSLETTERS) {
          try {
            log(`üîÑ Initializing: ${newsletter.name}`, 'info');

            const widget = new NeventSubscriptions.NewsletterWidget({
              newsletterId: newsletter.id,
              tenantId: TENANT_ID,
              apiUrl: API_URL,
              containerId: newsletter.containerId,
              debug: true,
              onLoad: () => {
                log(`‚úÖ ${newsletter.name}: Widget loaded`, 'success');
              },
              onSuccess: (response) => {
                log(`üéâ ${newsletter.name}: Subscription successful!`, 'success');
              },
              onError: (error) => {
                log(`‚ùå ${newsletter.name}: ${JSON.stringify(error)}`, 'error');
              },
            });

            await widget.init();
            log(`‚úÖ ${newsletter.name}: Initialized`, 'success');
          } catch (error) {
            log(`‚ùå ${newsletter.name}: ${error.message}`, 'error');
          }
        }

        log(`üéâ All widgets initialized!`, 'success');
      });
    </script>
  </body>
</html>
